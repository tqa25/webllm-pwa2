<!DOCTYPE html>


<section class="card">
<h2>Chọn / nạp mô hình</h2>
<label>
Preset model:
<select id="modelSelect">
<option value="Llama-3.2-1B-Instruct-q4f32_1-MLC">Llama-3.2‑1B‑Instruct (q4)</option>
<option value="Phi-2-q4f16_1-MLC">Phi‑2 (q4)</option>
<option value="TinyLlama-1.1B-Chat-v1.0-q4f16_1-MLC">TinyLlama‑1.1B‑Chat (q4)</option>
</select>
</label>


<div class="grid2">
<div>
<label>Custom model base URL (tùy chọn)
<input id="baseUrl" type="url" placeholder="http://localhost:8000/my-model/" />
</label>
<small>Ví dụ: thư mục chứa <code>params_shard_*.bin</code>, <code>mlc-chat-config.json</code>, <code>tokenizer.json</code>...</small>
</div>
<div>
<label>Tải model từ file (tùy chọn)
<input id="filePicker" type="file" multiple />
</label>
<small>Chọn nhiều file shard nếu bạn đã tải thủ công vào máy.</small>
</div>
</div>


<div class="actions">
<button id="btnPreload">Nạp model</button>
<button id="btnReset">Xóa cache model</button>
</div>


<progress id="progress" max="1" value="0"></progress>
<pre id="log" class="log"></pre>
</section>


<section class="card">
<h2>Chat (offline)</h2>
<div id="chatBox"></div>
<div class="row">
<input id="userInput" placeholder="Nhập câu hỏi..." />
<button id="sendBtn">Gửi</button>
</div>
</section>


<footer>
<small>Tip: lần đầu cần mạng để tải model; lần sau có thể rút mạng và dùng offline.</small>
</footer>


<script>

// Sự kiện "cài PWA"
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
e.preventDefault();
deferredPrompt = e;
const btn = document.getElementById('installBtn');
btn.hidden = false;
btn.addEventListener('click', async () => {
btn.hidden = true;
deferredPrompt.prompt();
await deferredPrompt.userChoice;
deferredPrompt = null;
});
});
</script>
<script type="module" src="./main.js"></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // Đăng ký SW với scope đúng thư mục Pages: /webllm-pwa2/
    navigator.serviceWorker.register('/webllm-pwa2/sw.js', { scope: '/webllm-pwa2/' })
      .then(r => console.log('SW registered:', r.scope))
      .catch(err => console.error('SW failed:', err));
  });
}
</script>

</body>
</html>
