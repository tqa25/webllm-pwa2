<!doctype html>
<html lang="vi">
<head>
  <!-- @version v1.2.1 (2025-10-27): merge Sessions + Diary into v1.1.1, sticky composer on empty chat, Stop button fix -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>WebLLM PWA ‚Äî Chat</title>

  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div id="app" class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <h1>WebLLM Chat</h1>
          <small class="muted">Local LLM on WebGPU</small>
        </div>
      </div>

      <!-- Sessions -->
      <div class="panel">
        <h3>Sessions</h3>
        <div id="sessionList" class="session-list">
          <!-- fixed diary -->
          <button class="session-item" data-id="__diary__">üìí Nh·∫≠t k√Ω</button>
        </div>
        <div class="row">
          <button id="btnNewSession" class="btn">+ New chat</button>
          <button id="btnRenameSession" class="btn">ƒê·ªïi t√™n</button>
          <button id="btnDeleteSession" class="btn danger">Xo√°</button>
        </div>
      </div>

      <div class="panel">
        <label for="modelSelect">Model</label>
        <select id="modelSelect" class="select"></select>

        <div class="row">
          <button id="btnInit" class="btn primary">N·∫°p model</button>
          <button id="btnRelease" class="btn">Gi·∫£i ph√≥ng</button>
        </div>

        <div class="progress-wrap">
          <progress id="progress" value="0" max="1"></progress>
          <div id="progressText" class="progress-text">Ch∆∞a t·∫£i</div>
        </div>

        <div class="status">
          <div>Tr·∫°ng th√°i: <span id="statusBadge" class="badge gray">Ch∆∞a kh·ªüi t·∫°o</span></div>
          <div class="tiny muted" id="envInfo"></div>
        </div>
      </div>

      <div class="panel">
        <div class="row">
          <button id="btnExport" class="btn">Export</button>
          <button id="btnTheme" class="btn">üåô/‚òÄÔ∏è</button>
          <button id="btnClearAll" class="btn danger">Xo√° t·∫•t c·∫£</button>
        </div>
      </div>

      <div class="panel">
        <h3>Log t·∫£i</h3>
        <pre id="log" class="log"></pre>
      </div>
    </aside>

    <!-- Backdrop for mobile -->
    <div id="backdrop" class="backdrop"></div>

    <!-- Chat area -->
    <main class="main">
      <header class="topbar">
        <button id="btnMenu" class="btn icon only-mobile" aria-label="Menu">‚ò∞</button>
        <div class="chip" id="loadedModel">Ch∆∞a n·∫°p model</div>
        <div class="inline-stats" id="usageStats"></div>
      </header>

      <!-- Empty welcome (shown only when no message in current session) -->
      <section id="welcome" class="welcome" hidden>
        <h2>Xin ch√†o üëã</h2>
        <p>B·∫Øt ƒë·∫ßu h·ªôi tho·∫°i ho·∫∑c ch·ªçn üìí <strong>Nh·∫≠t k√Ω</strong> ƒë·ªÉ ghi ch√©p c√° nh√¢n (l∆∞u c·ª•c b·ªô, kh√¥ng g·ª≠i LLM).</p>
        <div class="welcome-actions">
          <button id="btnStartChat" class="btn primary">B·∫Øt ƒë·∫ßu chat m·ªõi</button>
          <button id="btnOpenDiary" class="btn">M·ªü Nh·∫≠t k√Ω</button>
        </div>
      </section>

      <!-- Message list -->
      <section id="messages" class="messages" aria-live="polite"></section>

      <!-- Composer always at bottom -->
      <footer class="composer">
        <textarea id="input" rows="1" placeholder="Nh·∫≠p tin nh·∫Øn... (Shift+Enter ƒë·ªÉ xu·ªëng d√≤ng)"></textarea>
        <div class="composer-actions">
          <button id="btnStop" class="btn" disabled>D·ª´ng</button>
          <button id="btnSend" class="btn primary">G·ª≠i</button>
        </div>
      </footer>
    </main>
  </div>

  <script type="module" src="./main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
