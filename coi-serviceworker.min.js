// coi-serviceworker.min.js
// https://github.com/GoogleChromeLabs/coi-serviceworker
// Version: 0.1.7

!(function () {
  if ("undefined" == typeof window || !window.addEventListener) return;
  var e =
    "scroll" in window
      ? "addEventListener"
      : "attachEvent" in window
      ? "attachEvent"
      : null;
  if (!e) return;
  var o = "attachEvent" == e ? "on" : "",
    t = function (t, r, n) {
      window[e](o + t, r, n);
    },
    r = function (e, t, r) {
      window[(o ? "detachEvent" : "removeEventListener")](o + e, t, r);
    };
  function n(e) {
    if (e.data && "coi-serviceworker" === e.data.type) {
      var o = window.location.origin,
        t = window.location.pathname;
      (o === e.data.origin && t === e.data.pathname) ||
        (window.location.href = e.data.url);
    }
  }
  (window.COI = {
    init: function () {
      if (
        (window.crossOriginIsolated ||
          (window.isSecureContext &&
            (!document.head ||
              !document.head.querySelector(
                'meta[http-equiv="Cross-Origin-Embedder-Policy"]'
              ) ||
              !document.head.querySelector(
                'meta[http-equiv="Cross-Origin-Opener-Policy"]'
              )))) &&
        window.location.protocol === "https:" &&
        (function () {
          var e = window.localStorage.getItem("coi-serviceworker"),
            o = !1;
          try {
            o = JSON.parse(e);
          } catch (t) {}
          return o && 0 === o.length
            ? !1
            : (window.localStorage.setItem("coi-serviceworker", "[]"), !0);
        })()
      ) {
        var e = document.createElement("script");
        (e.src = URL.createObjectURL(
          new Blob(
            [
              "if(self.crossOriginIsolated)postMessage({type:'coi-serviceworker',origin:location.origin,pathname:location.pathname,url:location.href});else{importScripts(arguments[0]);addEventListener('message',function(e){e.data&&'coi-serviceworker'===e.data.type&&postMessage({type:'coi-serviceworker',origin:location.origin,pathname:location.pathname,url:location.href})},!1)}",
            ],
            { type: "application/javascript" }
          )
        )),
          e.setAttribute("data-src", "coi-serviceworker");
        var o = "coi-serviceworker.min.js";
        document.head.appendChild(e),
          (e.onload = function () {
            navigator.serviceWorker
              .register(e.src, { scope: "./", type: "module" })
              .then(
                function (e) {
                  return (
                    e.active || e.installing || e.waiting
                  ).postMessage(o);
                },
                function (e) {
                  console.error("COI ServiceWorker registration failed: ", e);
                }
              ),
              t("message", n);
          });
      }
    },
    uninit: function () {
      r("message", n);
    },
  }),
    window.COI.init();
})();